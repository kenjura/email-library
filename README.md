# Email Library

Library for sending email using SES. Contains some basic email templates. Implements "safe mode".


# Usage

## Local dev

Getting started:
* Clone repo
* Run ```npm i```
* Create /etc/email.env (using example file or this document)

Running end-to-end tests:
* Run ```npm start```


## Using in other apps and services
```js
const email = require('email-library')
await email.send({
  from:     'Cool Company <support@cool-company.co.ol>',  // optional, if process.env.EMAIL_FROM is specified in your containing app/service
  to:       'someone@somedomain.com',               // comma-separated list of email addresses (or array of same)
  subject:  'subject line',                         // optional, if process.env.EMAIL_SUBJECT is specified
  template: 'forgotPassword',                       // either "template" or "html" should be specified
  props:    { foo:'bar' }                           // if using "template", "props" should be an object containing all required props
})
```

## Templates


### Forgot Password
Template name: ```'forgotPassword'```
Required props:
* url (string, contains absolute URL of reset password link, sans token and preceding slash; e.g. "http://app.cool-company.co.ol/reset")
* token (string, the token generated by the forgot password workflow)


### more tbd



# Config
Email-library is powered by environment variables.

| Property         | Type    | Required | Description                                                                    | Example                                         |
|------------------|---------|----------|--------------------------------------------------------------------------------|-------------------------------------------------|
| SMTP_HOST        | String  | true     | Hostname of SMTP server                                                        | email-smtp.us-west-2.amazonaws.comSMTP_PORT=587 |
| SMTP_PORT        | Integer | true     | Port of SMTP server                                                            | 587                                             |
| SMTP_USER        | String  | true     | SMTP user name                                                                 | somesmtpusername                                |
| SMTP_PASS        | String  | true     | SMTP password                                                                  | correcthorsebatterystaple                       |
| EMAIL_MODE       | String  | false    | If not "production", emails send in "safe mode" (see below)                    | production                                      |
| EMAIL_SAFEDOMAIN | String  | true     | In safe mode, any destination email addresses not in this domain are not sent  | cool-company.co.ol
| EMAIL_FROM       | String  | false    | Name and email address in the "from" field of emails sent, when not overridden | Cool Company, Inc <support@cool-company.co.ol>  |
| EMAIL_SUBJECT    | String  | false    | Subject line of all emails, when not overridden                                | A message from Cool Company                     |


For information on setting up environment variables in any given app or service, please refer to that app or service's documentation.